(()=>{"use strict";var e,t={62134:(e,t,s)=>{var n=s(271);const r=class{constructor(){}};class a extends r{static getInstance(){return a._instance||(a._instance=new a),a._instance}constructor(){super(),this._currentScene=null}dispose(){this._currentScene&&(this._currentScene.disposeScene(),this._currentScene=null),T.getInstance().engine.stopRenderLoop()}switchToScene(e){this._currentScene&&this._currentScene.disposeScene(),this._currentScene=e,this._currentScene.loaded()}get currentSceneInstance(){return this._currentScene}}const i=a;var o;!function(e){e.LOADING="LOADING_SCENE",e.LOGIN="LOGIN_SCENE",e.TEST_MAP="TEST_MAP_SCENE"}(o||(o={}));const c=o;s(96860);class h extends n.Z58{constructor(e){super(T.getInstance().engine),this.metadata={sceneName:e.sceneName},this.preload(),this._showInspectorInDevelopmentMode()}disposeScene(){this.debugLayer.hide(),this.dispose()}setActiveCamera(e){var t;e&&(this.activeCamera&&(this.activeCamera.dispose(),this.removeCamera(this.activeCamera)),this.activeCamera=e,null===(t=this.activeCamera)||void 0===t||t.attachControl(!0))}_showInspectorInDevelopmentMode(){}get sceneName(){return this.metadata.sceneName}}const l=h,d=class extends l{constructor(e){super(e)}},u=class{constructor(e){this._speed=.1,this._mesh=e.mesh,this._visualMesh=e.visualMesh,this._kbInputController=e.kbInputController,this._camera=e.camera}update(){let e=n.Pq0.Zero();if(this._kbInputController.isKeyPressed("w")&&(e=e.add(n.Pq0.Forward())),this._kbInputController.isKeyPressed("s")&&(e=e.add(n.Pq0.Backward())),this._kbInputController.isKeyPressed("a")&&(e=e.add(n.Pq0.Left())),this._kbInputController.isKeyPressed("d")&&(e=e.add(n.Pq0.Right())),!e.equals(n.Pq0.Zero())){const t=this._camera.rotation.y,s=n.Pq0.TransformCoordinates(e,n.uqu.RotationY(t)).normalize();this._mesh.moveWithCollisions(s.scale(this._speed))}}_rotateMeshToCameraDirection(){this._camera.getForwardRay().direction}},_=["w","a","s","d","arrowup","arrowdown","arrowleft","arrowright"," "],p=class extends r{constructor(e){super(),this._inputMap={},this._scene=e.scene,this._onKeyPressedCallback=this._onKeyPressedCallback.bind(this),this._subscribeToKeyPressed()}isKeyPressed(e){return!!this._inputMap[e.toLowerCase()]}dispose(){this._keyboardObserver&&(this._scene.onKeyboardObservable.remove(this._keyboardObserver),this._keyboardObserver=void 0)}_onKeyPressedCallback(e){const t=e.event.key.toLowerCase();console.log(`KeyboardInputController.ts | Key "${t}" pressed`),_.includes(t)&&e.event.preventDefault(),this._inputMap[t]=e.type===n.TBB.KEYDOWN}_subscribeToKeyPressed(){this._keyboardObserver=this._scene.onKeyboardObservable.add(this._onKeyPressedCallback)}};class m{static _getEntityId(){return m._instancesCounter++,m._instancesCounter.toString()}constructor(e){this._id=m._getEntityId(),this._createMesh(e.modelPath).then((()=>this._onMeshLoaded()))}_createMesh(e){return t=this,s=void 0,a=function*(){var t,s;const r=i.getInstance().currentSceneInstance;if(!r)return;const a=yield(0,n.TkY)(e,r),o=a.meshes.find((e=>e.getChildMeshes().length>0&&e instanceof n.VR0&&!(e instanceof n.eaF))),c=a.meshes.find((e=>e instanceof n.eaF&&e.isVisible));this._mesh=null!==(t=null!=o?o:c)&&void 0!==t?t:a.meshes[0],this._visualMesh=null!=c?c:a.meshes[0],console.log("Entity.ts | Assigned mesh for camera target: ",null===(s=this._mesh)||void 0===s?void 0:s.name)},new((r=void 0)||(r=Promise))((function(e,n){function i(e){try{c(a.next(e))}catch(e){n(e)}}function o(e){try{c(a.throw(e))}catch(e){n(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof r?s:new r((function(e){e(s)}))).then(i,o)}c((a=a.apply(t,s||[])).next())}));var t,s,r,a}get id(){return this._id}get mesh(){return this._mesh}get visualMesh(){return this._visualMesh}get position(){var e;return null===(e=this._mesh)||void 0===e?void 0:e.position}}m._instancesCounter=0;const g=m,v=class extends g{constructor(e){super(e)}};class b extends n.Lqh{constructor(e){super("FollowPlayerCamera",-Math.PI/2,1.2,10,e.playerMesh.position.clone(),e.scene),this._minZoom=3,this._maxZoom=15,this._minY=1,this._maxY=1.2,this._targetRadius=10,this._zoomSmoothSpeed=.15,this._pointerObserver=null,this._isRotating=!1,this._lastPointerX=0,this._lastPointerY=0,this._playerMesh=e.playerMesh,this._targetRadius=this.radius,this._configureCamera(),this._createFakeTargetToFollow(),this._setupPointerControls();const t=document.createElement("button");t.innerText="Model rotation +=1",t.style.position="absolute",t.style.top="92%",t.style.left="85%",t.style.transform="translate(-50%, -50%)",t.onclick=()=>{console.log("FollowPlayerCamera.ts | +1 | : ",this.radius),this._playerMesh.rotate(n.Pq0.Up(),n.S0q.ToRadians(5))},document.body.appendChild(t)}update(){this.radius=n.X5X.Lerp(this.radius,this._targetRadius,this._zoomSmoothSpeed)}dispose(){this._pointerObserver&&this.getScene().onPointerObservable.remove(this._pointerObserver),super.dispose()}_configureCamera(){this.inputs.clear(),this.allowUpsideDown=!1,this.lowerRadiusLimit=this._minZoom,this.upperRadiusLimit=this._maxZoom,this.lowerBetaLimit=this._minY,this.upperBetaLimit=this._maxY}_createFakeTargetToFollow(){this._fakeTarget=new n.VR0("cameraTarget"),this._fakeTarget.parent=this._playerMesh,this._fakeTarget.position.y=1,this.setTarget(this._fakeTarget)}_setupPointerControls(){this._pointerObserver=this._scene.onPointerObservable.add((e=>{const t=e.event;switch(e.type){case n.Zph.POINTERDOWN:1===t.button&&(this._isRotating=!0,this._lastPointerX=t.clientX,this._lastPointerY=t.clientY);break;case n.Zph.POINTERUP:1===t.button&&(this._isRotating=!1);break;case n.Zph.POINTERMOVE:if(this._isRotating){const e=t.clientX-this._lastPointerX,s=t.clientY-this._lastPointerY;this.alpha-=.005*e,this.beta-=.005*s,this.beta=n.X5X.Clamp(this.beta,this._minY,this._maxY),this._lastPointerX=t.clientX,this._lastPointerY=t.clientY}break;case n.Zph.POINTERWHEEL:{const e=t,s=n.X5X.Clamp(.01*e.deltaY,-1,1);this._targetRadius=n.X5X.Clamp(this._targetRadius+s,this._minZoom,this._maxZoom);break}}}))}}const C=b,y=class extends v{constructor(e){super({modelPath:"assets/models/warrior.glb"}),this._kbInputController=null,this._movementController=null,this._name=e.name}update(){var e,t;const s=i.getInstance().currentSceneInstance;null===(e=this._movementController)||void 0===e||e.update(),null===(t=null==s?void 0:s.activeCamera)||void 0===t||t.update()}_onMeshLoaded(){this._createPlayerCamera(),this._createKbInputController(),this._createMovementController()}_createPlayerCamera(){const e=i.getInstance().currentSceneInstance;null==e||e.setActiveCamera(new C({scene:e,playerMesh:this.mesh}))}_createKbInputController(){const e=i.getInstance().currentSceneInstance;e&&(this._kbInputController=new p({scene:e}))}_createMovementController(){if(this.mesh&&this.visualMesh&&this._kbInputController){const e=i.getInstance().currentSceneInstance;this._movementController=new u({mesh:this.mesh,visualMesh:this.visualMesh,kbInputController:this._kbInputController,camera:null==e?void 0:e.activeCamera})}}},P=class extends l{constructor(e){super(e)}},w=class extends P{constructor(){super({sceneName:c.TEST_MAP}),this._playerCharacter=null}preload(){console.log('TestMapScene.ts | "preload" method execution'),this._createTempCamera()}loaded(){console.log('TestMapScene.ts | "loaded" method execution'),this._createTestMapSceneContent()}update(){var e;null===(e=this._playerCharacter)||void 0===e||e.update()}_createTestMapSceneContent(){new n.g4z("light",new n.Pq0(0,1,0),this);const e=n.PeD.CreateGround("ground",{width:600,height:600},this),t=new n.FUi("groundMat",this);t.diffuseTexture=new n.gPd("assets/textures/grass.png",this),t.diffuseTexture.uScale=150,t.diffuseTexture.vScale=150,e.material=t,this._playerCharacter=new y({name:"KriZ"})}_createTempCamera(){const e=new n.SCQ("tempCamera",new n.Pq0(0,5,-10),this);e.setTarget(n.Pq0.Zero()),this.setActiveCamera(e)}},I=class extends d{constructor(){super({sceneName:c.LOGIN})}preload(){console.log('LoginScene.ts | "preload" method execution'),this._createLoginSceneContent()}loaded(){console.log('LoginScene.ts | "loaded" method execution')}update(){}_createLoginSceneContent(){const e=T.getInstance().canvasElement;new n.Lqh("camera",Math.PI/2,Math.PI/3,10,n.Pq0.Zero(),this).attachControl(e,!0),new n.g4z("light",new n.Pq0(0,1,0),this);const t=n.PeD.CreateGround("ground",{width:6,height:6},this);this.onPointerObservable.add((e=>{var s;e.type===n.Zph.POINTERDOWN&&(null===(s=null==e?void 0:e.pickInfo)||void 0===s?void 0:s.hit)&&e.pickInfo.pickedMesh===t&&i.getInstance().switchToScene(new w)}))}},S=class extends d{constructor(){super({sceneName:c.LOADING}),this._switchToLoginScene()}preload(){console.log('LoadingScene.ts | "preload" method execution'),new n.Lqh("camera",Math.PI/2,Math.PI/3,10,n.Pq0.Zero(),this).attachControl(!0),new n.g4z("light",new n.Pq0(0,1,0),this)}loaded(){console.log('LoadingScene.ts | "loaded" method execution')}update(){}_switchToLoginScene(){setTimeout((()=>{i.getInstance().switchToScene(new I)}),5e3)}};class f extends r{constructor(){super(),this._gameStarted=!1,this._canvasElement=this._getCanvasHtmlElement(),this._engine=this._createEngineInstance(),this._addBrowserResizeHandler(),this._addRunRenderLoop()}static getInstance(){return void 0===f._instance&&(f._instance=new f),f._instance}startGame(){this._gameStarted?console.log("Game already started"):(i.getInstance().switchToScene(new S),console.log("Game started"),this._gameStarted=!0)}dispose(){i.getInstance().dispose(),this._engine.dispose()}_getCanvasHtmlElement(){return document.getElementById("renderCanvas")}_createEngineInstance(){return new n.N$8(this._canvasElement,!0)}_addBrowserResizeHandler(){window.addEventListener("resize",(()=>{this._engine.resize()}))}_addRunRenderLoop(){this._engine.runRenderLoop((()=>{const e=i.getInstance().currentSceneInstance;e&&!e.isDisposed&&(e.update(),e.render())}))}get canvasElement(){return this._canvasElement}get engine(){return this._engine}}const T=f;T.getInstance().startGame()}},s={};function n(e){var r=s[e];if(void 0!==r)return r.exports;var a=s[e]={exports:{}};return t[e](a,a.exports,n),a.exports}n.m=t,e=[],n.O=(t,s,r,a)=>{if(!s){var i=1/0;for(l=0;l<e.length;l++){for(var[s,r,a]=e[l],o=!0,c=0;c<s.length;c++)(!1&a||i>=a)&&Object.keys(n.O).every((e=>n.O[e](s[c])))?s.splice(c--,1):(o=!1,a<i&&(i=a));if(o){e.splice(l--,1);var h=r();void 0!==h&&(t=h)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[s,r,a]},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,s)=>{var r,a,[i,o,c]=s,h=0;if(i.some((t=>0!==e[t]))){for(r in o)n.o(o,r)&&(n.m[r]=o[r]);if(c)var l=c(n)}for(t&&t(s);h<i.length;h++)a=i[h],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(l)},s=self.webpackChunkbabylon_mmorpg_client=self.webpackChunkbabylon_mmorpg_client||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var r=n.O(void 0,[958],(()=>n(62134)));r=n.O(r)})();