(()=>{"use strict";var e,t={6523:(e,t,s)=>{s.d(t,{A:()=>r});var o=s(31601),n=s.n(o),a=s(76314),i=s.n(a)()(n());i.push([e.id,"body {\n\tmargin: 0;\n\toverflow: hidden;\n\theight: 100vh;\n\twidth: 100vw;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tbackground-color: rgba(0, 0, 0, 0.8);\n}\n\ncanvas {\n\twidth: calc(100vw - 10px);\n\theight: calc(100vh - 10px);\n\tdisplay: block;\n\tborder: 1px solid black;\n\tborder-radius: 10px;\n}\n\n.green-color {\n\tcolor: greenyellow;\n}\n\n.red-color {\n\tcolor: red;\n}\n\n.yellow-color {\n\tcolor: yellow;\n}\n\n#toggle-debug-status {\n\tposition: absolute;\n\tbottom: 10px;\n\tleft: 10px;\n\tbackground: rgba(0, 0, 0, 0.8);\n\tcolor: #fff;\n\tfont-family: monospace;\n\tpadding: 10px;\n\tborder-radius: 6px;\n\tfont-size: 13px;\n\tline-height: 1.4;\n\tpointer-events: none;\n\tz-index: 9999;\n}\n",""]);const r=i},93428:(e,t,s)=>{var o=s(85072),n=s.n(o),a=s(97825),i=s.n(a),r=s(77659),l=s.n(r),d=s(55056),c=s.n(d),h=s(10540),_=s.n(h),u=s(41113),g=s.n(u),m=s(6523),v={};v.styleTagTransform=g(),v.setAttributes=c(),v.insert=l().bind(null,"head"),v.domAPI=i(),v.insertStyleElement=_(),n()(m.A,v),m.A&&m.A.locals&&m.A.locals;var p=s(42936);const y=class{constructor(){}};class M extends y{static getInstance(){return M._instance||(M._instance=new M),M._instance}constructor(){super(),this._currentScene=null}dispose(){this._currentScene&&(this._currentScene.disposeScene(),this._currentScene=null),se.getInstance().engine.stopRenderLoop()}switchToScene(e){this._currentScene&&this._currentScene.disposeScene(),this._currentScene=e,this._currentScene.loaded()}get currentSceneInstance(){return this._currentScene}}const b=M;var I;!function(e){e.LOADING="LOADING_SCENE",e.LOGIN="LOGIN_SCENE",e.TEST_MAP="TEST_MAP_SCENE"}(I||(I={}));const P=I;s(96860);class f extends p.Z58{constructor(e){super(se.getInstance().engine),this.metadata={sceneName:e.sceneName},this.preload(),this._showInspectorInDevelopmentMode(),this._createGlowLayer()}disposeScene(){this.debugLayer.hide(),this.dispose()}setActiveCamera(e){var t;e&&(this.activeCamera&&(this.activeCamera.dispose(),this.removeCamera(this.activeCamera)),this.activeCamera=e,null===(t=this.activeCamera)||void 0===t||t.attachControl(!0))}_createGlowLayer(){this._glowLayer=new p.VA("glow",this)}_showInspectorInDevelopmentMode(){}get sceneName(){return this.metadata.sceneName}}const w=f,C=class extends w{constructor(e){super(e)}};var S=s(17159);const T=class{constructor(e){var t;this._characterInstance=e.characterInstance,this._characterMesh=null!==(t=e.characterInstance.rootNode)&&void 0!==t?t:null}},E=class extends T{constructor(e){super(e)}},A={IDLE:"Idle",WALKING:"Walking",RUNNING:"Running"},k=Object.values(A),N=A,L={IDLE:"Idle",WALKING:"Walking",RUNNING:"Running"},O=(Object.values(L),L),x=class extends E{constructor(e){super(e),this._currentlyPlayingAnimationGroups=[],this._lastMovementState="",this._characterInstance=e.characterInstance,this._playerMovementController=e.characterInstance.movementController,this._animationGroupsInstances=new Map,this._fillAnimationGroupsMap()}update(){this._playMovementAnimations(),this._moveAndRotateMesh()}_fillAnimationGroupsMap(){const e=b.getInstance().currentSceneInstance,t=null==e?void 0:e.animationGroups;k.forEach((e=>{const s=null==t?void 0:t.find((t=>t.name===e));s&&this._animationGroupsInstances.set(e,s)}))}_playMovementAnimations(){var e;const t=null===(e=this._playerMovementController)||void 0===e?void 0:e.movementState;if(t&&t!==this._lastMovementState)switch(this._lastMovementState=t,t){case O.IDLE:this._playAnimation(N.IDLE);break;case O.WALKING:this._playAnimation(N.WALKING,{speedRatio:1.8});break;case O.RUNNING:this._playAnimation(N.RUNNING,{speedRatio:2});break;default:console.log(`AnimationController.ts | Unknown movement state '${t}'`),this._playAnimation(N.IDLE)}}_moveAndRotateMesh(){var e,t,s;if((null===(e=this._playerMovementController)||void 0===e?void 0:e.isMoving)&&this._characterInstance){const e=null===(t=this._playerMovementController)||void 0===t?void 0:t.movementDirection;if(e){const t=Math.atan2(e.x,e.z)+Math.PI,o=p.PTz.FromEulerAngles(0,t,0);this._characterMesh&&(this._characterMesh.rotationQuaternion?p.PTz.SlerpToRef(this._characterMesh.rotationQuaternion,o,.3,null===(s=this._characterMesh)||void 0===s?void 0:s.rotationQuaternion):this._characterMesh.rotationQuaternion=o.clone())}}}_playAnimation(e,t){const s=this._characterInstance.characterModelsController.bodyPartsModels;s&&Object.values(s).forEach((s=>{const o=null==s?void 0:s.animationGroups.find((t=>t.name===e));if(o){this._stopAllAnimations();const s=!1!==(null==t?void 0:t.playInLoop),n=(null==t?void 0:t.speedRatio)?null==t?void 0:t.speedRatio:1;o.enableBlending=!0,o.blendingSpeed=e===N.WALKING?.1:.2,o.start(s,n),o&&this._currentlyPlayingAnimationGroups.push(o)}}))}_stopAllAnimations(){console.log("stopallanimations");for(const e of this._currentlyPlayingAnimationGroups)e.stop();this._currentlyPlayingAnimationGroups=[]}},R=class extends T{constructor(e){super(e),this._movementState=O.IDLE,this._movementDirection=p.Pq0.Zero(),this._currentSpeed=0,this._accelerationProgress=0,this._isMovingForward=!1,this._isMovingBackward=!1,this._isMovingLeft=!1,this._isMovingRight=!1,this._isMoving=!1,this._isRunning=!1,this._isRunningLocked=!1}};var B;!function(e){e.ZERO="0",e.ONE="1",e.TWO="2",e.THREE="3",e.FOUR="4",e.FIVE="5",e.SIX="6",e.SEVEN="7",e.EIGHT="8",e.NINE="9",e.A="a",e.B="b",e.C="c",e.D="d",e.E="e",e.F="f",e.G="g",e.H="h",e.I="i",e.J="j",e.K="k",e.L="l",e.M="m",e.N="n",e.O="o",e.P="p",e.Q="q",e.R="r",e.S="s",e.T="t",e.U="u",e.V="v",e.W="w",e.X="x",e.Y="y",e.Z="z",e.ARROW_UP="arrowup",e.ARROW_DOWN="arrowdown",e.ARROW_LEFT="arrowleft",e.ARROW_LIGHT="arrowright",e.BLOCK_MAYUS="capslock",e.SHIFT="shift",e.SPACE=" "}(B||(B={}));const G=B,K=class extends R{constructor(e){var t;super(e),this._kbInputController=null,this._camera=null,this._characterInstance=e.characterInstance,this._characterMesh=null!==(t=e.characterInstance.rootNode)&&void 0!==t?t:null,this._setKeyboardInputController(),this._setCamera(),this._addGlowSwitch(),this._addRunningSwitch()}update(){this._setMovingVariables(),this._calculateMoveDirection(),this._calculateSpeedAndMoveCharacter(),this._setMovementState()}_setKeyboardInputController(){this._kbInputController=this._characterInstance.keyboardInputController}_setCamera(){const e=b.getInstance().currentSceneInstance;(null==e?void 0:e.activeCamera)&&(this._camera=null==e?void 0:e.activeCamera)}_setMovingVariables(){var e,t,s,o,n,a,i,r,l,d;this._isMovingForward=null!==(t=null===(e=this._kbInputController)||void 0===e?void 0:e.isKeyPressed(G.W))&&void 0!==t&&t,this._isMovingBackward=null!==(o=null===(s=this._kbInputController)||void 0===s?void 0:s.isKeyPressed(G.S))&&void 0!==o&&o,this._isMovingLeft=null!==(a=null===(n=this._kbInputController)||void 0===n?void 0:n.isKeyPressed(G.A))&&void 0!==a&&a,this._isMovingRight=null!==(r=null===(i=this._kbInputController)||void 0===i?void 0:i.isKeyPressed(G.D))&&void 0!==r&&r,this._isMoving=this._isMovingForward||this._isMovingBackward||this._isMovingLeft||this._isMovingRight,this._isRunning=null!==(d=null===(l=this._kbInputController)||void 0===l?void 0:l.isKeyPressed(G.SHIFT))&&void 0!==d&&d}_calculateMoveDirection(){var e;if(this._isMoving){const t=null===(e=this._camera)||void 0===e?void 0:e.getForwardRay().direction,s=new p.Pq0(null==t?void 0:t.x,0,null==t?void 0:t.z).normalize(),o=p.Pq0.Cross(s,p.Pq0.Up()).normalize();this._isMovingForward&&(this._movementDirection=this._movementDirection.add(s)),this._isMovingBackward&&(this._movementDirection=this._movementDirection.subtract(s)),this._isMovingLeft&&(this._movementDirection=this._movementDirection.add(o)),this._isMovingRight&&(this._movementDirection=this._movementDirection.subtract(o)),this._movementDirection.normalize()}else this._movementDirection=p.Pq0.Zero()}_calculateSpeedAndMoveCharacter(){var e;if(this._isMoving){let t=this._characterInstance.walkSpeed,s=this._characterInstance.walkAcceleration;(this._isRunning||this._isRunningLocked)&&(t=this._characterInstance.runSpeed,s=this._characterInstance.runAcceleration),this._accelerationProgress+=s,this._accelerationProgress>1&&(this._accelerationProgress=1);const o=Math.pow(this._accelerationProgress,2);this._currentSpeed=o*t;const n=this._movementDirection.scale(this._currentSpeed);null===(e=this._characterMesh)||void 0===e||e.moveWithCollisions(n)}else this._currentSpeed=0,this._accelerationProgress=0}_setMovementState(){this._isMoving?(this._movementState=O.WALKING,(this._isRunning||this._isRunningLocked)&&(this._movementState=O.RUNNING)):this._movementState=O.IDLE}_addRunningSwitch(){var e;null===(e=this._kbInputController)||void 0===e||e.addToggleKey(G.BLOCK_MAYUS,{onSwitchON:()=>{this._isRunningLocked=!0},onSwitchOFF:()=>{this._isRunningLocked=!1}},"Running")}_addGlowSwitch(){var e;null===(e=this._kbInputController)||void 0===e||e.addToggleKey(G.G,{onSwitchON:()=>this._characterInstance.addGlow(),onSwitchOFF:()=>this._characterInstance.removeGlow()},"Glow")}get isMoving(){return this._isMoving}get movementState(){return this._movementState}get movementDirection(){return this._movementDirection}},D=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","arrowup","arrowdown","arrowleft","arrowright","capslock","shift"," "],F=class extends y{constructor(e){super(),this._inputMap={},this._toggleKeyStates={},this._toggleKeyCallbacks={},this._toggleKeyValues={},this._toggleStatusElement=null,this._toggleDisplayNames={},this._scene=e.scene,this._onKeyPressedCallback=this._onKeyPressedCallback.bind(this),this._setToggleStatusDebugInspector(),this._subscribeToKeyPressed()}isKeyPressed(e){return!!this._inputMap[e.toLowerCase()]}addToggleKey(e,t,s){const o=e.toLowerCase();this._toggleKeyCallbacks[o]=t,o in this._toggleKeyStates||(this._toggleKeyStates[o]=!1),o in this._toggleKeyValues||(this._toggleKeyValues[o]=!1),s&&(this._toggleDisplayNames[o]=s),this._renderToggleDebugStatus()}removeToggleKey(e){const t=e.toLowerCase();delete this._toggleKeyCallbacks[t],delete this._toggleKeyStates[t],delete this._toggleKeyValues[t]}isToggleOn(e){return!!this._toggleKeyValues[e.toLowerCase()]}dispose(){this._keyboardObserver&&(this._scene.onKeyboardObservable.remove(this._keyboardObserver),this._keyboardObserver=void 0)}_setToggleStatusDebugInspector(){this._toggleStatusElement=document.createElement("div"),this._toggleStatusElement.id="toggle-debug-status",document.body.appendChild(this._toggleStatusElement),this._renderToggleDebugStatus()}_subscribeToKeyPressed(){this._keyboardObserver=this._scene.onKeyboardObservable.add(this._onKeyPressedCallback)}_onKeyPressedCallback(e){const t=e.event.key.toLowerCase(),s=e.type===p.TBB.KEYDOWN;this._onUpdateKeyPressedLogic(e,t,s),this._onUpdateToggleLogic(t,s),this._renderToggleDebugStatus()}_onUpdateKeyPressedLogic(e,t,s){D.includes(t)&&e.event.preventDefault(),this._inputMap[t]=s,console.log("this._inputMap: ",t)}_onUpdateToggleLogic(e,t){if(this._toggleKeyCallbacks[e]){const s=this._toggleKeyStates[e];if(t&&!s){this._toggleKeyValues[e]=!this._toggleKeyValues[e];const t=this._toggleKeyCallbacks[e];this._toggleKeyValues[e]?t.onSwitchON():t.onSwitchOFF()}this._toggleKeyStates[e]=t}}_renderToggleDebugStatus(){}},Y={helm:"",armor:"",gloves:"",pants:"",boots:""},j={helm:null,armor:null,gloves:null,pants:null,boots:null};var z=function(e,t,s,o){return new(s||(s=Promise))((function(n,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function r(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,r)}l((o=o.apply(e,t||[])).next())}))};const V=class extends T{constructor(e){super(e),this._animationsModelInstance=null,this._bodyPartsModelsPaths=Object.assign({},Y),this._bodyPartsModelsInstances=Object.assign({},j),this._defaultBodyPartsModelsPaths=Object.assign({},Y),this._defaultBodyPartsModelsInstances=Object.assign({},j),this._rootNode=null,this._onMeshLoadedCallback=e.onMeshLoadedCallback,this._setAnimationsModelPath(),this._setDefaultBodyPartsModelsPaths(),this._setBodyPartsModelsPaths(),this._createAllModelsInstances().then((()=>{this._onMeshLoadedCallback&&this._onMeshLoadedCallback(),this._onMeshesLoaded()}))}_setAnimationsModelPath(){this._animationsModelPath="assets/models/character/character_animations_v1.glb"}_setDefaultBodyPartsModelsPaths(){this._defaultBodyPartsModelsPaths.helm="assets/models/class-warrior_helm_v1.gltf",this._defaultBodyPartsModelsPaths.armor="assets/models/class-warrior_armor_v1.gltf",this._defaultBodyPartsModelsPaths.gloves="assets/models/class-warrior_gloves_v1.gltf",this._defaultBodyPartsModelsPaths.pants="assets/models/class-warrior_pants_v1.gltf",this._defaultBodyPartsModelsPaths.boots="assets/models/class-warrior_boots_v1.gltf"}_setBodyPartsModelsPaths(){this._bodyPartsModelsPaths.helm="assets/models/leather_helm_v1.gltf",this._bodyPartsModelsPaths.armor="assets/models/leather_armor_v1.gltf",this._bodyPartsModelsPaths.gloves="assets/models/leather_gloves_v1.gltf",this._bodyPartsModelsPaths.pants="assets/models/leather_pants_v1.gltf",this._bodyPartsModelsPaths.boots="assets/models/leather_boots_v1.gltf"}_createAllModelsInstances(){return z(this,void 0,void 0,(function*(){const e=b.getInstance().currentSceneInstance;e&&(yield this._createAnimationsModelInstance(e),yield this._createDefaultBodyPartsModelsInstances(e),yield this._createBodyPartsModelsInstances(e))}))}_createAnimationsModelInstance(e){return z(this,void 0,void 0,(function*(){var t;this._animationsModelInstance=yield(0,p.TkY)(this._animationsModelPath,e),this._rootNode=null===(t=this._animationsModelInstance)||void 0===t?void 0:t.meshes[0]}))}_createDefaultBodyPartsModelsInstances(e){return z(this,void 0,void 0,(function*(){this._defaultBodyPartsModelsInstances.helm=yield(0,p.TkY)(this._defaultBodyPartsModelsPaths.helm,e),this._defaultBodyPartsModelsInstances.armor=yield(0,p.TkY)(this._defaultBodyPartsModelsPaths.armor,e),this._defaultBodyPartsModelsInstances.gloves=yield(0,p.TkY)(this._defaultBodyPartsModelsPaths.gloves,e),this._defaultBodyPartsModelsInstances.pants=yield(0,p.TkY)(this._defaultBodyPartsModelsPaths.pants,e),this._defaultBodyPartsModelsInstances.boots=yield(0,p.TkY)(this._defaultBodyPartsModelsPaths.boots,e)}))}_createBodyPartsModelsInstances(e){return z(this,void 0,void 0,(function*(){var t,s,o,n,a,i,r,l,d,c;this._bodyPartsModelsInstances.helm=yield(0,p.TkY)(this._bodyPartsModelsPaths.helm,e),null===(s=null===(t=this._bodyPartsModelsInstances.helm)||void 0===t?void 0:t.meshes.find((e=>"__root__"===e.id)))||void 0===s||s.setEnabled(!1),this._bodyPartsModelsInstances.armor=yield(0,p.TkY)(this._bodyPartsModelsPaths.armor,e),null===(n=null===(o=this._bodyPartsModelsInstances.armor)||void 0===o?void 0:o.meshes.find((e=>"__root__"===e.id)))||void 0===n||n.setEnabled(!1),this._bodyPartsModelsInstances.gloves=yield(0,p.TkY)(this._bodyPartsModelsPaths.gloves,e),null===(i=null===(a=this._bodyPartsModelsInstances.gloves)||void 0===a?void 0:a.meshes.find((e=>"__root__"===e.id)))||void 0===i||i.setEnabled(!1),this._bodyPartsModelsInstances.pants=yield(0,p.TkY)(this._bodyPartsModelsPaths.pants,e),null===(l=null===(r=this._bodyPartsModelsInstances.pants)||void 0===r?void 0:r.meshes.find((e=>"__root__"===e.id)))||void 0===l||l.setEnabled(!1),this._bodyPartsModelsInstances.boots=yield(0,p.TkY)(this._bodyPartsModelsPaths.boots,e),null===(c=null===(d=this._bodyPartsModelsInstances.boots)||void 0===d?void 0:d.meshes.find((e=>"__root__"===e.id)))||void 0===c||c.setEnabled(!1)}))}_onMeshesLoaded(){var e,t,s,o,n;this._attachBodyPartsModelsToAnimationsModel(),this._copyAnimationsForEachBodyPartModel(),this._setKeysToToggleLeatherTest(),this._applyExcellentEffect(null===(e=this._bodyPartsModelsInstances.helm)||void 0===e?void 0:e.meshes),this._applyExcellentEffect(null===(t=this._bodyPartsModelsInstances.armor)||void 0===t?void 0:t.meshes),this._applyExcellentEffect(null===(s=this._bodyPartsModelsInstances.gloves)||void 0===s?void 0:s.meshes),this._applyExcellentEffect(null===(o=this._bodyPartsModelsInstances.pants)||void 0===o?void 0:o.meshes),this._applyExcellentEffect(null===(n=this._bodyPartsModelsInstances.boots)||void 0===n?void 0:n.meshes)}_attachBodyPartsModelsToAnimationsModel(){var e,t,s,o,n,a,i,r,l,d;this._rootNode&&(null===(e=this._defaultBodyPartsModelsInstances.helm)||void 0===e||e.meshes[0].setParent(this._rootNode),null===(t=this._defaultBodyPartsModelsInstances.armor)||void 0===t||t.meshes[0].setParent(this._rootNode),null===(s=this._defaultBodyPartsModelsInstances.gloves)||void 0===s||s.meshes[0].setParent(this._rootNode),null===(o=this._defaultBodyPartsModelsInstances.pants)||void 0===o||o.meshes[0].setParent(this._rootNode),null===(n=this._defaultBodyPartsModelsInstances.boots)||void 0===n||n.meshes[0].setParent(this._rootNode),null===(a=this._bodyPartsModelsInstances.helm)||void 0===a||a.meshes[0].setParent(this._rootNode),null===(i=this._bodyPartsModelsInstances.armor)||void 0===i||i.meshes[0].setParent(this._rootNode),null===(r=this._bodyPartsModelsInstances.gloves)||void 0===r||r.meshes[0].setParent(this._rootNode),null===(l=this._bodyPartsModelsInstances.pants)||void 0===l||l.meshes[0].setParent(this._rootNode),null===(d=this._bodyPartsModelsInstances.boots)||void 0===d||d.meshes[0].setParent(this._rootNode))}_copyAnimationsForEachBodyPartModel(){return z(this,void 0,void 0,(function*(){var e;const t=b.getInstance().currentSceneInstance;null===(e=this._animationsModelInstance)||void 0===e||e.animationGroups.forEach((e=>{const s=new p.klW(e.name,t);Object.values(this._defaultBodyPartsModelsInstances).forEach((t=>{if(t){const o={};[...t.meshes,...t.transformNodes].forEach((e=>{o[e.name]=e}));for(const t of e.targetedAnimations){const e=t.target,n=o[e.name];if(n){const e=t.animation.clone();s.addTargetedAnimation(e,n)}}t.animationGroups.push(s)}})),Object.values(this._bodyPartsModelsInstances).forEach((t=>{if(t){const o={};[...t.meshes,...t.transformNodes].forEach((e=>{o[e.name]=e}));for(const t of e.targetedAnimations){const e=t.target,n=o[e.name];if(n){const e=t.animation.clone();s.addTargetedAnimation(e,n)}}t.animationGroups.push(s)}}))}))}))}get rootNode(){return this._rootNode}get rootModel(){return this._animationsModelInstance}get bodyPartsModels(){return this._defaultBodyPartsModelsInstances}_toggleHelmModel(e){var t,s;const o=this._defaultBodyPartsModelsInstances.helm,n=this._bodyPartsModelsInstances.helm;n&&o&&(null===(t=n.meshes.find((e=>"__root__"===e.id)))||void 0===t||t.setEnabled(e),null===(s=o.meshes.find((e=>"__root__"===e.id)))||void 0===s||s.setEnabled(!e))}_toggleArmorModel(e){var t,s;const o=this._defaultBodyPartsModelsInstances.armor,n=this._bodyPartsModelsInstances.armor;n&&o&&(null===(t=n.meshes.find((e=>"__root__"===e.id)))||void 0===t||t.setEnabled(e),null===(s=o.meshes.find((e=>"__root__"===e.id)))||void 0===s||s.setEnabled(!e))}_toggleGlovesModel(e){var t,s;const o=this._defaultBodyPartsModelsInstances.gloves,n=this._bodyPartsModelsInstances.gloves;n&&o&&(null===(t=n.meshes.find((e=>"__root__"===e.id)))||void 0===t||t.setEnabled(e),null===(s=o.meshes.find((e=>"__root__"===e.id)))||void 0===s||s.setEnabled(!e))}_togglePantsModel(e){var t,s;const o=this._defaultBodyPartsModelsInstances.pants,n=this._bodyPartsModelsInstances.pants;n&&o&&(null===(t=n.meshes.find((e=>"__root__"===e.id)))||void 0===t||t.setEnabled(e),null===(s=o.meshes.find((e=>"__root__"===e.id)))||void 0===s||s.setEnabled(!e))}_toggleBootsModel(e){var t,s;const o=this._defaultBodyPartsModelsInstances.boots,n=this._bodyPartsModelsInstances.boots;n&&o&&(null===(t=n.meshes.find((e=>"__root__"===e.id)))||void 0===t||t.setEnabled(e),null===(s=o.meshes.find((e=>"__root__"===e.id)))||void 0===s||s.setEnabled(!e))}_hsvToRgb(e,t,s){const o=s*t,n=o*(1-Math.abs(e/60%2-1)),a=s-o;let i=0,r=0,l=0;return e>=0&&e<60?[i,r,l]=[o,n,0]:e>=60&&e<120?[i,r,l]=[n,o,0]:e>=120&&e<180?[i,r,l]=[0,o,n]:e>=180&&e<240?[i,r,l]=[0,n,o]:e>=240&&e<300?[i,r,l]=[n,0,o]:e>=300&&e<360&&([i,r,l]=[o,0,n]),new p.v9j(i+a,r+a,l+a)}_applyExcellentEffect(e){if(e)for(const t of e){const e=t.material;if(!e)continue;const s=new p.gPd("assets/textures/effect_excellent.png",t.getScene());s.uScale=1,s.vScale=1,e.emissiveTexture=s,e.emissiveTexture.hasAlpha=!0,e.emissiveColor.set(1,1,1);const o=[{color:new p.v9j(.2,.4,1),duration:2e3},{color:new p.v9j(1,.3,.7),duration:1400},{color:new p.v9j(1,1,.2),duration:600}];let n=0,a=0;t.getScene().onBeforeRenderObservable.add((()=>{const t=se.getInstance().engine.getDeltaTime();a+=t;const s=o[n],i=o[(n+1)%o.length],r=Math.min(a/s.duration,1),l=p.v9j.Lerp(s.color,i.color,r);e.emissiveColor=l.scale(.025),r>=1&&(n=(n+1)%o.length,a=0)}))}}_setKeysToToggleLeatherTest(){var e,t,s,o,n;null===(e=this._characterInstance.keyboardInputController)||void 0===e||e.addToggleKey(G.ONE,{onSwitchON:()=>{this._toggleHelmModel(!0)},onSwitchOFF:()=>{this._toggleHelmModel(!1)}},"Leather Helm"),null===(t=this._characterInstance.keyboardInputController)||void 0===t||t.addToggleKey(G.TWO,{onSwitchON:()=>{this._toggleArmorModel(!0)},onSwitchOFF:()=>{this._toggleArmorModel(!1)}},"Leather Armor"),null===(s=this._characterInstance.keyboardInputController)||void 0===s||s.addToggleKey(G.THREE,{onSwitchON:()=>{this._toggleGlovesModel(!0)},onSwitchOFF:()=>{this._toggleGlovesModel(!1)}},"Leather Gloves"),null===(o=this._characterInstance.keyboardInputController)||void 0===o||o.addToggleKey(G.FOUR,{onSwitchON:()=>{this._togglePantsModel(!0)},onSwitchOFF:()=>{this._togglePantsModel(!1)}},"Leather Pants"),null===(n=this._characterInstance.keyboardInputController)||void 0===n||n.addToggleKey(G.FIVE,{onSwitchON:()=>{this._toggleBootsModel(!0)},onSwitchOFF:()=>{this._toggleBootsModel(!1)}},"Leather Boots")}};class Z{static _getEntityId(){return Z._instancesCounter++,Z._instancesCounter.toString()}constructor(){this._id=Z._getEntityId()}get id(){return this._id}}Z._instancesCounter=0;const H=Z,W=class extends H{constructor(e){super(),this._name=e.characterName,this._characterModelsControllerInstance=new V({characterInstance:this,onMeshLoadedCallback:this._onMeshLoaded.bind(this)})}get name(){return this._name}get characterModelsController(){return this._characterModelsControllerInstance}get rootModel(){var e;return null===(e=this._characterModelsControllerInstance)||void 0===e?void 0:e.rootModel}get rootNode(){var e;return null===(e=this._characterModelsControllerInstance)||void 0===e?void 0:e.rootNode}};class U extends p.Lqh{constructor(e){super("FollowPlayerCamera",-Math.PI/2,1.2,10,e.playerMesh.position.clone(),e.scene),this._minZoom=3,this._maxZoom=15,this._minY=1,this._maxY=1.2,this._targetRadius=10,this._zoomSmoothSpeed=.15,this._clickToMoveCamera=0,this._pointerObserver=null,this._isRotating=!1,this._lastPointerX=0,this._lastPointerY=0,this._playerMesh=e.playerMesh,this._targetRadius=this.radius,this._configureCamera(),this._createFakeTargetToFollow(),this._setupPointerControls(),this._addDebugButtons()}update(){this.radius=p.X5X.Lerp(this.radius,this._targetRadius,this._zoomSmoothSpeed)}dispose(){this._pointerObserver&&this.getScene().onPointerObservable.remove(this._pointerObserver),super.dispose()}_configureCamera(){this.inputs.clear(),this.allowUpsideDown=!1,this.lowerRadiusLimit=this._minZoom,this.upperRadiusLimit=this._maxZoom,this.lowerBetaLimit=this._minY,this.upperBetaLimit=this._maxY}_createFakeTargetToFollow(){this._fakeTarget=new p.VR0("cameraTarget"),this._fakeTarget.parent=this._playerMesh,this._fakeTarget.position.y=1,this.setTarget(this._fakeTarget)}_setupPointerControls(){this._pointerObserver=this._scene.onPointerObservable.add((e=>{const t=e.event;switch(e.type){case p.Zph.POINTERDOWN:t.button===this._clickToMoveCamera&&(this._isRotating=!0,this._lastPointerX=t.clientX,this._lastPointerY=t.clientY);break;case p.Zph.POINTERUP:t.button===this._clickToMoveCamera&&(this._isRotating=!1);break;case p.Zph.POINTERMOVE:if(this._isRotating){const e=t.clientX-this._lastPointerX,s=t.clientY-this._lastPointerY;this.alpha-=.005*e,this.beta-=.005*s,this.beta=p.X5X.Clamp(this.beta,this._minY,this._maxY),this._lastPointerX=t.clientX,this._lastPointerY=t.clientY}break;case p.Zph.POINTERWHEEL:{const e=t,s=p.X5X.Clamp(.01*e.deltaY,-1,1);this._targetRadius=p.X5X.Clamp(this._targetRadius+s,this._minZoom,this._maxZoom);break}}}))}_addDebugButtons(){}}const q=U,X=class extends W{constructor(e){super(e),this._walkSpeed=.08,this._walkAcceleration=.1,this._runSpeed=.16,this._runAcceleration=.1,this._kbInputController=null,this._movementController=null,this._animationController=null}update(){var e,t,s;const o=b.getInstance().currentSceneInstance;null===(e=this._movementController)||void 0===e||e.update(),null===(t=null==o?void 0:o.activeCamera)||void 0===t||t.update(),null===(s=this._animationController)||void 0===s||s.update()}_onMeshLoaded(){this._createPlayerCamera(),this._createKbInputController(),this._createMovementController(),this._createAnimationsController()}_createPlayerCamera(){const e=b.getInstance().currentSceneInstance;this.rootNode&&(null==e||e.setActiveCamera(new q({scene:e,playerMesh:this.rootNode})))}_createKbInputController(){const e=b.getInstance().currentSceneInstance;e&&(this._kbInputController=new F({scene:e}))}_createMovementController(){this._movementController=new K({characterInstance:this})}_createAnimationsController(){this._animationController=new x({characterInstance:this})}addGlow(){var e;null===(e=b.getInstance().currentSceneInstance)||void 0===e||e.meshes.forEach((e=>{e&&"texture_class-warrior_v1.jpg"===e.id&&e.material&&e.material instanceof p.YOq&&(e.material.emissiveTexture=e.material.albedoTexture,e.material.emissiveColor=new p.v9j(1,.8,.2).scale(.75))}))}removeGlow(){const e=b.getInstance().currentSceneInstance;e&&e.meshes.forEach((e=>{e&&"texture_class-warrior_v1.jpg"===e.id&&e.material&&e.material instanceof p.YOq&&(e.material.emissiveTexture=null,e.material.emissiveColor=p.v9j.Black())}))}get keyboardInputController(){return this._kbInputController}get movementController(){return this._movementController}get walkSpeed(){return this._walkSpeed}get walkAcceleration(){return this._walkAcceleration}get runSpeed(){return this._runSpeed}get runAcceleration(){return this._runAcceleration}},Q=class extends w{constructor(e){super(e)}},J=class extends Q{constructor(){super({sceneName:P.TEST_MAP}),this._playerCharacter=null}preload(){console.log('TestMapScene.ts | "preload" method execution'),this._createTempCamera()}loaded(){console.log('TestMapScene.ts | "loaded" method execution'),this._createTestMapSceneContent(),(e=>{const t=S.vs.CreateFullscreenUI("UI",!0,e),s=new S.tN("InfoBox");s.widthInPixels=270,s.heightInPixels=140,s.cornerRadius=10,s.color="white",s.thickness=1,s.background="#000000AA",s.horizontalAlignment=S.Ec.HORIZONTAL_ALIGNMENT_LEFT,s.verticalAlignment=S.Ec.VERTICAL_ALIGNMENT_TOP,s.paddingTopInPixels=5,s.paddingLeftInPixels=5;const o=new S.mc("Panel"),n=new S.mc("TitleContainer"),a=new S.VJ("Titulo");a.text="Controls",a.fontSize=18,a.textHorizontalAlignment=S.Ec.HORIZONTAL_ALIGNMENT_CENTER,a.textVerticalAlignment=S.Ec.VERTICAL_ALIGNMENT_TOP,a.paddingTopInPixels=8;const i=S.$n.CreateSimpleButton("close","✕");i.width="30px",i.height="30px",i.color="white",i.background="#AA0000",i.cornerRadius=5,i.horizontalAlignment=S.Ec.HORIZONTAL_ALIGNMENT_RIGHT,i.verticalAlignment=S.Ec.VERTICAL_ALIGNMENT_TOP,i.paddingTop="5px",i.paddingRight="5px",i.onPointerUpObservable.add((()=>{s.isVisible=!1})),i.isHitTestVisible=!0,i.onPointerEnterObservable.add((()=>{document.body.style.cursor="pointer"})),i.onPointerOutObservable.add((()=>{document.body.style.cursor="default"}));const r=new S.mc("TextContainer"),l=new S.VJ("Texto");l.text="\n• Movement: W-A-S-D\n• Rotate camera: Hold mouse left-click\n• Zoom: Mouse scroll\n• Run: Shift\n• Run lock/unlock: Caps Lock\n• Glow: G",l.color="white",l.fontSize=13,l.textHorizontalAlignment=S.Ec.HORIZONTAL_ALIGNMENT_LEFT,l.textVerticalAlignment=S.Ec.VERTICAL_ALIGNMENT_CENTER,l.paddingLeftInPixels=10,l.paddingTopInPixels=10,l.textWrapping=!0,n.addControl(a),n.addControl(i),o.addControl(n),r.addControl(l),o.addControl(r),s.addControl(o),t.addControl(s)})(this)}update(){var e;null===(e=this._playerCharacter)||void 0===e||e.update()}_createTestMapSceneContent(){new p.g4z("light",new p.Pq0(0,1,0),this);const e=p.PeD.CreateGround("ground",{width:600,height:600},this),t=new p.FUi("groundMat",this);t.diffuseTexture=new p.gPd("assets/textures/grass.png",this),t.diffuseTexture.uScale=150,t.diffuseTexture.vScale=150,e.material=t,this._playerCharacter=new X({characterName:"KriZ"})}_createTempCamera(){const e=new p.SCQ("tempCamera",new p.Pq0(0,5,-10),this);e.setTarget(p.Pq0.Zero()),this.setActiveCamera(e)}},$=class extends C{constructor(){super({sceneName:P.LOGIN})}preload(){console.log('LoginScene.ts | "preload" method execution'),this._createLoginSceneContent()}loaded(){console.log('LoginScene.ts | "loaded" method execution')}update(){}_createLoginSceneContent(){const e=se.getInstance().canvasElement,t=new p.Lqh("camera",0,0,10,p.Pq0.Zero(),this);t.setPosition(new p.Pq0(0,10,0)),t.target=p.Pq0.Zero(),t.lowerBetaLimit=0,t.upperBetaLimit=0,t.attachControl(e,!0),new p.g4z("light",new p.Pq0(0,1,0),this);const s=p.PeD.CreateGround("ground",{width:6,height:3},this);s.rotation.y=Math.PI;const o=new p.RCS("dynamic texture",{width:1024,height:512},this,!1);o.hasAlpha=!1;const n=o.getContext();n.fillStyle="#696969",n.fillRect(0,0,1024,512),o.drawText("Click here to start",null,256,"bold 110px Arial","black","#f8f8ff",!0);const a=new p.FUi("textMat",this);a.diffuseTexture=o,a.backFaceCulling=!1,a.specularColor=new p.v9j(0,0,0),s.material=a,this.onPointerObservable.add((e=>{var t;e.type===p.Zph.POINTERDOWN&&(null===(t=null==e?void 0:e.pickInfo)||void 0===t?void 0:t.hit)&&e.pickInfo.pickedMesh===s&&b.getInstance().switchToScene(new J)}))}},ee=class extends C{constructor(){super({sceneName:P.LOADING}),this._switchToLoginScene()}preload(){console.log('LoadingScene.ts | "preload" method execution'),new p.Lqh("camera",Math.PI/2,Math.PI/3,10,p.Pq0.Zero(),this).attachControl(!0),new p.g4z("light",new p.Pq0(0,1,0),this)}loaded(){console.log('LoadingScene.ts | "loaded" method execution')}update(){}_switchToLoginScene(){setTimeout((()=>{b.getInstance().switchToScene(new $)}),5e3)}};class te extends y{constructor(){super(),this._gameStarted=!1,this._canvasElement=this._getCanvasHtmlElement(),this._fixCanvasSizeForDevelopmentMode(),this._engine=this._createEngineInstance(),this._addBrowserResizeHandler(),this._addRunRenderLoop()}static getInstance(){return void 0===te._instance&&(te._instance=new te),te._instance}startGame(){this._gameStarted?console.log("Game already started"):(b.getInstance().switchToScene(new ee),console.log("Game started"),this._gameStarted=!0)}dispose(){b.getInstance().dispose(),this._engine.dispose()}_getCanvasHtmlElement(){return document.getElementById("renderCanvas")}_createEngineInstance(){return new p.N$8(this._canvasElement,!0)}_addBrowserResizeHandler(){window.addEventListener("resize",(()=>{this._engine.resize()}))}_addRunRenderLoop(){this._engine.runRenderLoop((()=>{const e=b.getInstance().currentSceneInstance;e&&!e.isDisposed&&(e.update(),e.render())}))}_fixCanvasSizeForDevelopmentMode(){}get canvasElement(){return this._canvasElement}get engine(){return this._engine}}const se=te;se.getInstance().startGame()}},s={};function o(e){var n=s[e];if(void 0!==n)return n.exports;var a=s[e]={id:e,exports:{}};return t[e](a,a.exports,o),a.exports}o.m=t,e=[],o.O=(t,s,n,a)=>{if(!s){var i=1/0;for(c=0;c<e.length;c++){for(var[s,n,a]=e[c],r=!0,l=0;l<s.length;l++)(!1&a||i>=a)&&Object.keys(o.O).every((e=>o.O[e](s[l])))?s.splice(l--,1):(r=!1,a<i&&(i=a));if(r){e.splice(c--,1);var d=n();void 0!==d&&(t=d)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[s,n,a]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};o.O.j=t=>0===e[t];var t=(t,s)=>{var n,a,[i,r,l]=s,d=0;if(i.some((t=>0!==e[t]))){for(n in r)o.o(r,n)&&(o.m[n]=r[n]);if(l)var c=l(o)}for(t&&t(s);d<i.length;d++)a=i[d],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(c)},s=self.webpackChunkbabylon_mmorpg_client=self.webpackChunkbabylon_mmorpg_client||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),o.nc=void 0;var n=o.O(void 0,[127],(()=>o(93428)));n=o.O(n)})();