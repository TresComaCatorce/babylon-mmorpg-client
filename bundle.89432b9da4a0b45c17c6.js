(()=>{"use strict";var e,t={92448:(e,t,n)=>{var s=n(271);const a=class{constructor(){}};class r extends a{static getInstance(){return r._instance||(r._instance=new r),r._instance}constructor(){super(),this._currentScene=null}dispose(){this._currentScene&&(this._currentScene.disposeScene(),this._currentScene=null),x.getInstance().engine.stopRenderLoop()}switchToScene(e){this._currentScene&&this._currentScene.disposeScene(),this._currentScene=e,this._currentScene.loaded()}get currentSceneInstance(){return this._currentScene}}const i=r;var o;!function(e){e.LOADING="LOADING_SCENE",e.LOGIN="LOGIN_SCENE",e.TEST_MAP="TEST_MAP_SCENE"}(o||(o={}));const c=o;n(96860);class l extends s.Z58{constructor(e){super(x.getInstance().engine),this.metadata={sceneName:e.sceneName},this.preload(),this._showInspectorInDevelopmentMode()}disposeScene(){this.debugLayer.hide(),this.dispose()}setActiveCamera(e){var t;e&&(this.activeCamera&&(this.activeCamera.dispose(),this.removeCamera(this.activeCamera)),this.activeCamera=e,null===(t=this.activeCamera)||void 0===t||t.attachControl(!0))}_showInspectorInDevelopmentMode(){}get sceneName(){return this.metadata.sceneName}}const h=l,d=class extends h{constructor(e){super(e)}},u={IDLE:"Idle",WALKING:"Walking",RUNING:"Running"},_=(Object.values(u),u),m=class{constructor(e){this._characterMesh=null,this._kbInputController=null,this._camera=null,this._speed=.1,this._playerCharacterInstance=e.playerCharacter,this._movementState=_.IDLE,this._setCharacterMesh(),this._setKeyboardInputController(),this._setCamera()}update(){var e,t,n,a,r;const i=null===(e=this._kbInputController)||void 0===e?void 0:e.isKeyPressed("w"),o=null===(t=this._kbInputController)||void 0===t?void 0:t.isKeyPressed("s"),c=null===(n=this._kbInputController)||void 0===n?void 0:n.isKeyPressed("a"),l=null===(a=this._kbInputController)||void 0===a?void 0:a.isKeyPressed("d");let h=s.Pq0.Zero();if(i||o||c||l){const e=null===(r=this._camera)||void 0===r?void 0:r.getForwardRay().direction,t=new s.Pq0(null==e?void 0:e.x,0,null==e?void 0:e.z).normalize(),n=s.Pq0.Cross(t,s.Pq0.Up()).normalize();i&&(h=h.add(t)),o&&(h=h.subtract(t)),c&&(h=h.add(n)),l&&(h=h.subtract(n)),h.normalize()}if(h.equals(s.Pq0.Zero()))this._movementState=_.IDLE;else if(this._movementState=_.WALKING,this._characterMesh){const e=Math.atan2(h.x,h.z)+Math.PI,t=s.PTz.FromEulerAngles(0,e,0);this._characterMesh.rotationQuaternion?s.PTz.SlerpToRef(this._characterMesh.rotationQuaternion,t,.3,this._characterMesh.rotationQuaternion):this._characterMesh.rotationQuaternion=t.clone(),this._characterMesh.moveWithCollisions(h.scale(this._speed))}}_setCharacterMesh(){this._playerCharacterInstance.mesh&&(this._characterMesh=this._playerCharacterInstance.mesh)}_setKeyboardInputController(){this._kbInputController=this._playerCharacterInstance.keyboardInputController}_setCamera(){const e=i.getInstance().currentSceneInstance;(null==e?void 0:e.activeCamera)&&(this._camera=null==e?void 0:e.activeCamera)}get movementState(){return this._movementState}},p=["w","a","s","d","arrowup","arrowdown","arrowleft","arrowright"," "],v=class extends a{constructor(e){super(),this._inputMap={},this._scene=e.scene,this._onKeyPressedCallback=this._onKeyPressedCallback.bind(this),this._subscribeToKeyPressed()}isKeyPressed(e){return!!this._inputMap[e.toLowerCase()]}dispose(){this._keyboardObserver&&(this._scene.onKeyboardObservable.remove(this._keyboardObserver),this._keyboardObserver=void 0)}_onKeyPressedCallback(e){const t=e.event.key.toLowerCase();p.includes(t)&&e.event.preventDefault(),this._inputMap[t]=e.type===s.TBB.KEYDOWN}_subscribeToKeyPressed(){this._keyboardObserver=this._scene.onKeyboardObservable.add(this._onKeyPressedCallback)}};class g{static _getEntityId(){return g._instancesCounter++,g._instancesCounter.toString()}constructor(e){this._id=g._getEntityId(),this._createMesh(e.modelPath).then((()=>this._onMeshLoaded()))}_createMesh(e){return t=this,n=void 0,r=function*(){var t,n;const a=i.getInstance().currentSceneInstance;if(!a)return;const r=yield(0,s.TkY)(e,a),o=r.meshes.find((e=>e.getChildMeshes().length>0&&e instanceof s.VR0&&!(e instanceof s.eaF))),c=r.meshes.find((e=>e instanceof s.eaF&&e.isVisible));this._mesh=null!==(t=null!=o?o:c)&&void 0!==t?t:r.meshes[0],console.log("Entity.ts | Assigned mesh for camera target: ",null===(n=this._mesh)||void 0===n?void 0:n.name)},new((a=void 0)||(a=Promise))((function(e,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(i,o)}c((r=r.apply(t,n||[])).next())}));var t,n,a,r}get id(){return this._id}get mesh(){return this._mesh}get position(){var e;return null===(e=this._mesh)||void 0===e?void 0:e.position}}g._instancesCounter=0;const C=g,I=class extends C{constructor(e){super(e)}};class b extends s.Lqh{constructor(e){super("FollowPlayerCamera",-Math.PI/2,1.2,10,e.playerMesh.position.clone(),e.scene),this._minZoom=3,this._maxZoom=15,this._minY=1,this._maxY=1.2,this._targetRadius=10,this._zoomSmoothSpeed=.15,this._clickToMoveCamera=0,this._pointerObserver=null,this._isRotating=!1,this._lastPointerX=0,this._lastPointerY=0,this._playerMesh=e.playerMesh,this._targetRadius=this.radius,this._configureCamera(),this._createFakeTargetToFollow(),this._setupPointerControls(),this._addDebugButtons()}update(){this.radius=s.X5X.Lerp(this.radius,this._targetRadius,this._zoomSmoothSpeed)}dispose(){this._pointerObserver&&this.getScene().onPointerObservable.remove(this._pointerObserver),super.dispose()}_configureCamera(){this.inputs.clear(),this.allowUpsideDown=!1,this.lowerRadiusLimit=this._minZoom,this.upperRadiusLimit=this._maxZoom,this.lowerBetaLimit=this._minY,this.upperBetaLimit=this._maxY}_createFakeTargetToFollow(){this._fakeTarget=new s.VR0("cameraTarget"),this._fakeTarget.parent=this._playerMesh,this._fakeTarget.position.y=1,this.setTarget(this._fakeTarget)}_setupPointerControls(){this._pointerObserver=this._scene.onPointerObservable.add((e=>{const t=e.event;switch(e.type){case s.Zph.POINTERDOWN:t.button===this._clickToMoveCamera&&(this._isRotating=!0,this._lastPointerX=t.clientX,this._lastPointerY=t.clientY);break;case s.Zph.POINTERUP:t.button===this._clickToMoveCamera&&(this._isRotating=!1);break;case s.Zph.POINTERMOVE:if(this._isRotating){const e=t.clientX-this._lastPointerX,n=t.clientY-this._lastPointerY;this.alpha-=.005*e,this.beta-=.005*n,this.beta=s.X5X.Clamp(this.beta,this._minY,this._maxY),this._lastPointerX=t.clientX,this._lastPointerY=t.clientY}break;case s.Zph.POINTERWHEEL:{const e=t,n=s.X5X.Clamp(.01*e.deltaY,-1,1);this._targetRadius=s.X5X.Clamp(this._targetRadius+n,this._minZoom,this._maxZoom);break}}}))}_addDebugButtons(){}}const y=b,P={IDLE:"Idle",WALKING:"Walking",RUNING:"Running"},S=Object.values(P),w=P,f=class{constructor(e){this._currentlyPlayingAnimationGroups=[],this._lastMovementState="",this._playerCharacterInstance=e.playerCharacter,this._animationGroupsInstances=new Map,this._fillAnimationGroupsMap()}update(){var e;const t=null===(e=this._playerCharacterInstance.movementController)||void 0===e?void 0:e.movementState;if(t&&t!==this._lastMovementState)switch(this._lastMovementState=t,t){case _.IDLE:this._playAnimation(w.IDLE);break;case _.WALKING:this._playAnimation(w.WALKING);break;default:console.log(`AnimationController.ts | Unknown movement state '${t}'`),this._playAnimation(w.IDLE)}}_fillAnimationGroupsMap(){const e=i.getInstance().currentSceneInstance,t=null==e?void 0:e.animationGroups;S.forEach((e=>{const n=null==t?void 0:t.find((t=>t.name===e));n&&this._animationGroupsInstances.set(e,n)}))}_playAnimation(e,t=!0){console.log(`playanimation: ${e}`);const n=this._animationGroupsInstances.get(e);n&&(this._stopAllAnimations(),n.enableBlending=!0,n.blendingSpeed=.05,n.start(t),this._currentlyPlayingAnimationGroups.push(n))}_stopAllAnimations(){console.log("stopallanimations");for(const e of this._currentlyPlayingAnimationGroups)e.stop();this._currentlyPlayingAnimationGroups=[]}},M=class extends I{constructor(e){super({modelPath:"assets/models/warrior.glb"}),this._kbInputController=null,this._movementController=null,this._animationController=null,this._name=e.name}update(){var e,t,n;const s=i.getInstance().currentSceneInstance;null===(e=this._movementController)||void 0===e||e.update(),null===(t=null==s?void 0:s.activeCamera)||void 0===t||t.update(),null===(n=this._animationController)||void 0===n||n.update()}_onMeshLoaded(){this._createPlayerCamera(),this._createKbInputController(),this._createMovementController(),this._createAnimationController()}_createPlayerCamera(){const e=i.getInstance().currentSceneInstance;null==e||e.setActiveCamera(new y({scene:e,playerMesh:this.mesh}))}_createKbInputController(){const e=i.getInstance().currentSceneInstance;e&&(this._kbInputController=new v({scene:e}))}_createMovementController(){this._movementController=new m({playerCharacter:this})}_createAnimationController(){this._animationController=new f({playerCharacter:this})}get keyboardInputController(){return this._kbInputController}get movementController(){return this._movementController}},T=class extends h{constructor(e){super(e)}},k=class extends T{constructor(){super({sceneName:c.TEST_MAP}),this._playerCharacter=null}preload(){console.log('TestMapScene.ts | "preload" method execution'),this._createTempCamera()}loaded(){console.log('TestMapScene.ts | "loaded" method execution'),this._createTestMapSceneContent()}update(){var e;null===(e=this._playerCharacter)||void 0===e||e.update()}_createTestMapSceneContent(){new s.g4z("light",new s.Pq0(0,1,0),this);const e=s.PeD.CreateGround("ground",{width:600,height:600},this),t=new s.FUi("groundMat",this);t.diffuseTexture=new s.gPd("assets/textures/grass.png",this),t.diffuseTexture.uScale=150,t.diffuseTexture.vScale=150,e.material=t,this._playerCharacter=new M({name:"KriZ"})}_createTempCamera(){const e=new s.SCQ("tempCamera",new s.Pq0(0,5,-10),this);e.setTarget(s.Pq0.Zero()),this.setActiveCamera(e)}},L=class extends d{constructor(){super({sceneName:c.LOGIN})}preload(){console.log('LoginScene.ts | "preload" method execution'),this._createLoginSceneContent()}loaded(){console.log('LoginScene.ts | "loaded" method execution')}update(){}_createLoginSceneContent(){const e=x.getInstance().canvasElement;new s.Lqh("camera",Math.PI/2,Math.PI/3,10,s.Pq0.Zero(),this).attachControl(e,!0),new s.g4z("light",new s.Pq0(0,1,0),this);const t=s.PeD.CreateGround("ground",{width:6,height:6},this);this.onPointerObservable.add((e=>{var n;e.type===s.Zph.POINTERDOWN&&(null===(n=null==e?void 0:e.pickInfo)||void 0===n?void 0:n.hit)&&e.pickInfo.pickedMesh===t&&i.getInstance().switchToScene(new k)}))}},O=class extends d{constructor(){super({sceneName:c.LOADING}),this._switchToLoginScene()}preload(){console.log('LoadingScene.ts | "preload" method execution'),new s.Lqh("camera",Math.PI/2,Math.PI/3,10,s.Pq0.Zero(),this).attachControl(!0),new s.g4z("light",new s.Pq0(0,1,0),this)}loaded(){console.log('LoadingScene.ts | "loaded" method execution')}update(){}_switchToLoginScene(){setTimeout((()=>{i.getInstance().switchToScene(new L)}),5e3)}};class E extends a{constructor(){super(),this._gameStarted=!1,this._canvasElement=this._getCanvasHtmlElement(),this._engine=this._createEngineInstance(),this._addBrowserResizeHandler(),this._addRunRenderLoop()}static getInstance(){return void 0===E._instance&&(E._instance=new E),E._instance}startGame(){this._gameStarted?console.log("Game already started"):(i.getInstance().switchToScene(new O),console.log("Game started"),this._gameStarted=!0)}dispose(){i.getInstance().dispose(),this._engine.dispose()}_getCanvasHtmlElement(){return document.getElementById("renderCanvas")}_createEngineInstance(){return new s.N$8(this._canvasElement,!0)}_addBrowserResizeHandler(){window.addEventListener("resize",(()=>{this._engine.resize()}))}_addRunRenderLoop(){this._engine.runRenderLoop((()=>{const e=i.getInstance().currentSceneInstance;e&&!e.isDisposed&&(e.update(),e.render())}))}get canvasElement(){return this._canvasElement}get engine(){return this._engine}}const x=E;x.getInstance().startGame()}},n={};function s(e){var a=n[e];if(void 0!==a)return a.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,s),r.exports}s.m=t,e=[],s.O=(t,n,a,r)=>{if(!n){var i=1/0;for(h=0;h<e.length;h++){for(var[n,a,r]=e[h],o=!0,c=0;c<n.length;c++)(!1&r||i>=r)&&Object.keys(s.O).every((e=>s.O[e](n[c])))?n.splice(c--,1):(o=!1,r<i&&(i=r));if(o){e.splice(h--,1);var l=a();void 0!==l&&(t=l)}}return t}r=r||0;for(var h=e.length;h>0&&e[h-1][2]>r;h--)e[h]=e[h-1];e[h]=[n,a,r]},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var a,r,[i,o,c]=n,l=0;if(i.some((t=>0!==e[t]))){for(a in o)s.o(o,a)&&(s.m[a]=o[a]);if(c)var h=c(s)}for(t&&t(n);l<i.length;l++)r=i[l],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(h)},n=self.webpackChunkbabylon_mmorpg_client=self.webpackChunkbabylon_mmorpg_client||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=s.O(void 0,[958],(()=>s(92448)));a=s.O(a)})();