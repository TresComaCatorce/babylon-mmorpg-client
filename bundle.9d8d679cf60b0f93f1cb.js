(()=>{"use strict";var e,t={92448:(e,t,n)=>{var s=n(271);const i=class{constructor(){}};class o extends i{static getInstance(){return o._instance||(o._instance=new o),o._instance}constructor(){super(),this._currentScene=null}dispose(){this._currentScene&&(this._currentScene.disposeScene(),this._currentScene=null),E.getInstance().engine.stopRenderLoop()}switchToScene(e){this._currentScene&&this._currentScene.disposeScene(),this._currentScene=e,this._currentScene.loaded()}get currentSceneInstance(){return this._currentScene}}const a=o;var r;!function(e){e.LOADING="LOADING_SCENE",e.LOGIN="LOGIN_SCENE",e.TEST_MAP="TEST_MAP_SCENE"}(r||(r={}));const l=r;n(96860);class c extends s.Z58{constructor(e){super(E.getInstance().engine),this.metadata={sceneName:e.sceneName},this.preload(),this._showInspectorInDevelopmentMode()}disposeScene(){this.debugLayer.hide(),this.dispose()}setActiveCamera(e){var t;e&&(this.activeCamera&&(this.activeCamera.dispose(),this.removeCamera(this.activeCamera)),this.activeCamera=e,null===(t=this.activeCamera)||void 0===t||t.attachControl(!0))}_showInspectorInDevelopmentMode(){}get sceneName(){return this.metadata.sceneName}}const h=c,d=class extends h{constructor(e){super(e)}},u={IDLE:"Idle",WALKING:"Walking",RUNING:"Running"},_=(Object.values(u),u),m=class{constructor(e){this._kbInputController=null,this._camera=null,this._movementDirection=s.Pq0.Zero(),this._isMovingForward=!1,this._isMovingBackward=!1,this._isMovingLeft=!1,this._isMovingRight=!1,this._isMoving=!1,this._playerCharacterInstance=e.playerCharacter,this._movementState=_.IDLE,this._setKeyboardInputController(),this._setCamera()}update(){this._setMovingVariables(),this._calculateMoveDirection(),this._setMovementState()}_setKeyboardInputController(){this._kbInputController=this._playerCharacterInstance.keyboardInputController}_setCamera(){const e=a.getInstance().currentSceneInstance;(null==e?void 0:e.activeCamera)&&(this._camera=null==e?void 0:e.activeCamera)}_setMovingVariables(){var e,t,n,s,i,o,a,r;this._isMovingForward=null!==(t=null===(e=this._kbInputController)||void 0===e?void 0:e.isKeyPressed("w"))&&void 0!==t&&t,this._isMovingBackward=null!==(s=null===(n=this._kbInputController)||void 0===n?void 0:n.isKeyPressed("s"))&&void 0!==s&&s,this._isMovingLeft=null!==(o=null===(i=this._kbInputController)||void 0===i?void 0:i.isKeyPressed("a"))&&void 0!==o&&o,this._isMovingRight=null!==(r=null===(a=this._kbInputController)||void 0===a?void 0:a.isKeyPressed("d"))&&void 0!==r&&r,this._isMoving=this._isMovingForward||this._isMovingBackward||this._isMovingLeft||this._isMovingRight}_calculateMoveDirection(){var e;if(this._isMoving){const t=null===(e=this._camera)||void 0===e?void 0:e.getForwardRay().direction,n=new s.Pq0(null==t?void 0:t.x,0,null==t?void 0:t.z).normalize(),i=s.Pq0.Cross(n,s.Pq0.Up()).normalize();this._isMovingForward&&(this._movementDirection=this._movementDirection.add(n)),this._isMovingBackward&&(this._movementDirection=this._movementDirection.subtract(n)),this._isMovingLeft&&(this._movementDirection=this._movementDirection.add(i)),this._isMovingRight&&(this._movementDirection=this._movementDirection.subtract(i)),this._movementDirection.normalize()}else this._movementDirection=s.Pq0.Zero()}_setMovementState(){this._isMoving?this._movementState=_.WALKING:this._movementState=_.IDLE}get movementState(){return this._movementState}get movementDirection(){return this._movementDirection}},p=["w","a","s","d","arrowup","arrowdown","arrowleft","arrowright"," "],v=class extends i{constructor(e){super(),this._inputMap={},this._scene=e.scene,this._onKeyPressedCallback=this._onKeyPressedCallback.bind(this),this._subscribeToKeyPressed()}isKeyPressed(e){return!!this._inputMap[e.toLowerCase()]}dispose(){this._keyboardObserver&&(this._scene.onKeyboardObservable.remove(this._keyboardObserver),this._keyboardObserver=void 0)}_onKeyPressedCallback(e){const t=e.event.key.toLowerCase();p.includes(t)&&e.event.preventDefault(),this._inputMap[t]=e.type===s.TBB.KEYDOWN}_subscribeToKeyPressed(){this._keyboardObserver=this._scene.onKeyboardObservable.add(this._onKeyPressedCallback)}};class g{static _getEntityId(){return g._instancesCounter++,g._instancesCounter.toString()}constructor(e){this._id=g._getEntityId(),this._createMesh(e.modelPath).then((()=>this._onMeshLoaded()))}_createMesh(e){return t=this,n=void 0,o=function*(){var t,n;const i=a.getInstance().currentSceneInstance;if(!i)return;const o=yield(0,s.TkY)(e,i),r=o.meshes.find((e=>e.getChildMeshes().length>0&&e instanceof s.VR0&&!(e instanceof s.eaF))),l=o.meshes.find((e=>e instanceof s.eaF&&e.isVisible));this._mesh=null!==(t=null!=r?r:l)&&void 0!==t?t:o.meshes[0],console.log("Entity.ts | Assigned mesh for camera target: ",null===(n=this._mesh)||void 0===n?void 0:n.name)},new((i=void 0)||(i=Promise))((function(e,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,r)}l((o=o.apply(t,n||[])).next())}));var t,n,i,o}get id(){return this._id}get mesh(){return this._mesh}get position(){var e;return null===(e=this._mesh)||void 0===e?void 0:e.position}}g._instancesCounter=0;const C=g,y=class extends C{constructor(e){super(e)}};class b extends s.Lqh{constructor(e){super("FollowPlayerCamera",-Math.PI/2,1.2,10,e.playerMesh.position.clone(),e.scene),this._minZoom=3,this._maxZoom=15,this._minY=1,this._maxY=1.2,this._targetRadius=10,this._zoomSmoothSpeed=.15,this._clickToMoveCamera=0,this._pointerObserver=null,this._isRotating=!1,this._lastPointerX=0,this._lastPointerY=0,this._playerMesh=e.playerMesh,this._targetRadius=this.radius,this._configureCamera(),this._createFakeTargetToFollow(),this._setupPointerControls(),this._addDebugButtons()}update(){this.radius=s.X5X.Lerp(this.radius,this._targetRadius,this._zoomSmoothSpeed)}dispose(){this._pointerObserver&&this.getScene().onPointerObservable.remove(this._pointerObserver),super.dispose()}_configureCamera(){this.inputs.clear(),this.allowUpsideDown=!1,this.lowerRadiusLimit=this._minZoom,this.upperRadiusLimit=this._maxZoom,this.lowerBetaLimit=this._minY,this.upperBetaLimit=this._maxY}_createFakeTargetToFollow(){this._fakeTarget=new s.VR0("cameraTarget"),this._fakeTarget.parent=this._playerMesh,this._fakeTarget.position.y=1,this.setTarget(this._fakeTarget)}_setupPointerControls(){this._pointerObserver=this._scene.onPointerObservable.add((e=>{const t=e.event;switch(e.type){case s.Zph.POINTERDOWN:t.button===this._clickToMoveCamera&&(this._isRotating=!0,this._lastPointerX=t.clientX,this._lastPointerY=t.clientY);break;case s.Zph.POINTERUP:t.button===this._clickToMoveCamera&&(this._isRotating=!1);break;case s.Zph.POINTERMOVE:if(this._isRotating){const e=t.clientX-this._lastPointerX,n=t.clientY-this._lastPointerY;this.alpha-=.005*e,this.beta-=.005*n,this.beta=s.X5X.Clamp(this.beta,this._minY,this._maxY),this._lastPointerX=t.clientX,this._lastPointerY=t.clientY}break;case s.Zph.POINTERWHEEL:{const e=t,n=s.X5X.Clamp(.01*e.deltaY,-1,1);this._targetRadius=s.X5X.Clamp(this._targetRadius+n,this._minZoom,this._maxZoom);break}}}))}_addDebugButtons(){}}const I=b,w={IDLE:"Idle",WALKING:"Walking",RUNING:"Running"},M=Object.values(w),S=w,f=class{constructor(e){var t;this._currentlyPlayingAnimationGroups=[],this._lastMovementState="",this._playerCharacterInstance=e.playerCharacter,this._playerCharacterMesh=null!==(t=e.playerCharacter.mesh)&&void 0!==t?t:null,this._playerMovementController=e.playerCharacter.movementController,this._animationGroupsInstances=new Map,this._fillAnimationGroupsMap()}update(){var e;const t=null===(e=this._playerMovementController)||void 0===e?void 0:e.movementState;this._playMovementAnimations(t),this._moveAndRotateMesh(t)}_fillAnimationGroupsMap(){const e=a.getInstance().currentSceneInstance,t=null==e?void 0:e.animationGroups;M.forEach((e=>{const n=null==t?void 0:t.find((t=>t.name===e));n&&this._animationGroupsInstances.set(e,n)}))}_playMovementAnimations(e){if(e&&e!==this._lastMovementState)switch(this._lastMovementState=e,e){case _.IDLE:this._playAnimation(S.IDLE);break;case _.WALKING:this._playAnimation(S.WALKING);break;default:console.log(`AnimationController.ts | Unknown movement state '${e}'`),this._playAnimation(S.IDLE)}}_moveAndRotateMesh(e){var t;if(e===_.WALKING&&this._playerCharacterMesh){const e=null===(t=this._playerMovementController)||void 0===t?void 0:t.movementDirection;if(e){const t=Math.atan2(e.x,e.z)+Math.PI,n=s.PTz.FromEulerAngles(0,t,0);this._playerCharacterMesh.rotationQuaternion?s.PTz.SlerpToRef(this._playerCharacterMesh.rotationQuaternion,n,.3,this._playerCharacterMesh.rotationQuaternion):this._playerCharacterMesh.rotationQuaternion=n.clone(),this._playerCharacterMesh.moveWithCollisions(e.scale(this._playerCharacterInstance.walkSpeed))}}}_playAnimation(e,t=!0){console.log(`playanimation: ${e}`);const n=this._animationGroupsInstances.get(e);n&&(this._stopAllAnimations(),n.enableBlending=!0,n.blendingSpeed=.05,n.start(t),this._currentlyPlayingAnimationGroups.push(n))}_stopAllAnimations(){console.log("stopallanimations");for(const e of this._currentlyPlayingAnimationGroups)e.stop();this._currentlyPlayingAnimationGroups=[]}},P=class extends y{constructor(e){super({modelPath:"assets/models/warrior.glb"}),this._kbInputController=null,this._movementController=null,this._animationController=null,this._walkSpeed=.1,this._runSpeed=.2,this._name=e.name}update(){var e,t,n;const s=a.getInstance().currentSceneInstance;null===(e=this._movementController)||void 0===e||e.update(),null===(t=null==s?void 0:s.activeCamera)||void 0===t||t.update(),null===(n=this._animationController)||void 0===n||n.update()}_onMeshLoaded(){this._createPlayerCamera(),this._createKbInputController(),this._createMovementController(),this._createAnimationController()}_createPlayerCamera(){const e=a.getInstance().currentSceneInstance;null==e||e.setActiveCamera(new I({scene:e,playerMesh:this.mesh}))}_createKbInputController(){const e=a.getInstance().currentSceneInstance;e&&(this._kbInputController=new v({scene:e}))}_createMovementController(){this._movementController=new m({playerCharacter:this})}_createAnimationController(){this._animationController=new f({playerCharacter:this})}get keyboardInputController(){return this._kbInputController}get movementController(){return this._movementController}get walkSpeed(){return this._walkSpeed}get runSpeed(){return this._runSpeed}},k=class extends h{constructor(e){super(e)}},L=class extends k{constructor(){super({sceneName:l.TEST_MAP}),this._playerCharacter=null}preload(){console.log('TestMapScene.ts | "preload" method execution'),this._createTempCamera()}loaded(){console.log('TestMapScene.ts | "loaded" method execution'),this._createTestMapSceneContent()}update(){var e;null===(e=this._playerCharacter)||void 0===e||e.update()}_createTestMapSceneContent(){new s.g4z("light",new s.Pq0(0,1,0),this);const e=s.PeD.CreateGround("ground",{width:600,height:600},this),t=new s.FUi("groundMat",this);t.diffuseTexture=new s.gPd("assets/textures/grass.png",this),t.diffuseTexture.uScale=150,t.diffuseTexture.vScale=150,e.material=t,this._playerCharacter=new P({name:"KriZ"})}_createTempCamera(){const e=new s.SCQ("tempCamera",new s.Pq0(0,5,-10),this);e.setTarget(s.Pq0.Zero()),this.setActiveCamera(e)}},T=class extends d{constructor(){super({sceneName:l.LOGIN})}preload(){console.log('LoginScene.ts | "preload" method execution'),this._createLoginSceneContent()}loaded(){console.log('LoginScene.ts | "loaded" method execution')}update(){}_createLoginSceneContent(){const e=E.getInstance().canvasElement,t=new s.Lqh("camera",0,0,10,s.Pq0.Zero(),this);t.setPosition(new s.Pq0(0,10,0)),t.target=s.Pq0.Zero(),t.lowerBetaLimit=0,t.upperBetaLimit=0,t.attachControl(e,!0),new s.g4z("light",new s.Pq0(0,1,0),this);const n=s.PeD.CreateGround("ground",{width:6,height:3},this);n.rotation.y=Math.PI;const i=new s.RCS("dynamic texture",{width:1024,height:512},this,!1);i.hasAlpha=!1;const o=i.getContext();o.fillStyle="#696969",o.fillRect(0,0,1024,512),i.drawText("Click here to start",null,256,"bold 110px Arial","black","#f8f8ff",!0);const r=new s.FUi("textMat",this);r.diffuseTexture=i,r.backFaceCulling=!1,r.specularColor=new s.v9j(0,0,0),n.material=r,this.onPointerObservable.add((e=>{var t;e.type===s.Zph.POINTERDOWN&&(null===(t=null==e?void 0:e.pickInfo)||void 0===t?void 0:t.hit)&&e.pickInfo.pickedMesh===n&&a.getInstance().switchToScene(new L)}))}},O=class extends d{constructor(){super({sceneName:l.LOADING}),this._switchToLoginScene()}preload(){console.log('LoadingScene.ts | "preload" method execution'),new s.Lqh("camera",Math.PI/2,Math.PI/3,10,s.Pq0.Zero(),this).attachControl(!0),new s.g4z("light",new s.Pq0(0,1,0),this)}loaded(){console.log('LoadingScene.ts | "loaded" method execution')}update(){}_switchToLoginScene(){setTimeout((()=>{a.getInstance().switchToScene(new T)}),5e3)}};class x extends i{constructor(){super(),this._gameStarted=!1,this._canvasElement=this._getCanvasHtmlElement(),this._engine=this._createEngineInstance(),this._addBrowserResizeHandler(),this._addRunRenderLoop()}static getInstance(){return void 0===x._instance&&(x._instance=new x),x._instance}startGame(){this._gameStarted?console.log("Game already started"):(a.getInstance().switchToScene(new O),console.log("Game started"),this._gameStarted=!0)}dispose(){a.getInstance().dispose(),this._engine.dispose()}_getCanvasHtmlElement(){return document.getElementById("renderCanvas")}_createEngineInstance(){return new s.N$8(this._canvasElement,!0)}_addBrowserResizeHandler(){window.addEventListener("resize",(()=>{this._engine.resize()}))}_addRunRenderLoop(){this._engine.runRenderLoop((()=>{const e=a.getInstance().currentSceneInstance;e&&!e.isDisposed&&(e.update(),e.render())}))}get canvasElement(){return this._canvasElement}get engine(){return this._engine}}const E=x;E.getInstance().startGame()}},n={};function s(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,s),o.exports}s.m=t,e=[],s.O=(t,n,i,o)=>{if(!n){var a=1/0;for(h=0;h<e.length;h++){for(var[n,i,o]=e[h],r=!0,l=0;l<n.length;l++)(!1&o||a>=o)&&Object.keys(s.O).every((e=>s.O[e](n[l])))?n.splice(l--,1):(r=!1,o<a&&(a=o));if(r){e.splice(h--,1);var c=i();void 0!==c&&(t=c)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[n,i,o]},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var i,o,[a,r,l]=n,c=0;if(a.some((t=>0!==e[t]))){for(i in r)s.o(r,i)&&(s.m[i]=r[i]);if(l)var h=l(s)}for(t&&t(n);c<a.length;c++)o=a[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(h)},n=self.webpackChunkbabylon_mmorpg_client=self.webpackChunkbabylon_mmorpg_client||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=s.O(void 0,[958],(()=>s(92448)));i=s.O(i)})();